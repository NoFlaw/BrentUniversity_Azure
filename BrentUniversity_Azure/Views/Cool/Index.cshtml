@model BrentUniversity_Azure.Data.Student
@{
    ViewBag.Title = "GetAllStudents";
}

<h2>GetAllStudents</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table>
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.LastName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.FirstName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.EnrollmentDate)
            </th>
            <th>Action</th>
        </tr>
    </thead>

    <tbody data-bind="foreach: Students">
        <tr>
            <td data-bind="text: LastName"></td>
            <td data-bind="text: FirstName"></td>
            <td data-bind="text: EnrollmentDate"></td>
        </tr>
    </tbody>

</table>

@section scripts{

    @*<script src="~/Scripts/knockout-3.3.0.debug.js"></script>
    <script src="~/Scripts/knockout.mapping-latest.debug.js"></script>*@
    
    <script type="text/javascript">
    //var urlPath = window.location.pathname;
    //var ViewModel = ko.mapping.fromJS(@Html.Raw(Json.Encode(Model)));

    $(function () {
        ko.applyBindings(StudentViewModel);
        StudentViewModel.getStudents();
    });

        //View Model
        var StudentViewModel = {
            Students: ko.observableArray([]),
            getStudents: function () {
                var self = this;
                $.ajax({
                    type: "GET",
                    url: '/Cool/GetAllStudents',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        self.Students(data); //Put the response in ObservableArray
                    },
                    error: function (err) {
                        alert(err.status + " : " + err.statusText);
                    }
                });
            },
        };

        //Model
        function Students(data) {
            this.Id = ko.observable(data.StudentId);
            this.FirstName = ko.observable(data.FirstName);
            this.LastName = ko.observable(data.LastName);
            this.EnrollmentDate = ko.observable(data.EnrollmentDate);
        }

        //self.editStudent = function (student) {
        //    window.location.href = '/Student/Edit/' + student.StudentId;
        //};
        //self.deleteStudent = function (student) {
        //    window.location.href = '/Student/Delete/' + student.StudentId;
        //};

    </script>  
 



}
